<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>WhiteUsedSocks 노래 소트</title>

  <style>
    body { font-family: '돋움', sans-serif; background:#fff; color:#000; }
    #mainTable{
      font-size: 12px;
      text-align: center;
      vertical-align: middle;
      width: 420px;
      margin: 20px auto;
      border-collapse: separate;
      border-spacing: 10px 8px;
    }
    #battleNumber{
      padding-bottom: 10px;
      font-size: 13px;
      line-height: 1.4;
    }
    #leftField, #rightField{
      width: 180px;
      height: 220px;
      border: 1px solid #000;
      cursor: pointer;
      padding: 8px;
      box-sizing: border-box;
    }
    .middleField{
      width: 140px;
      height: 70px;
      border: 1px solid #000;
      cursor: pointer;
      user-select:none;
    }
    .card img{
      width: 140px;
      height: 140px;
      object-fit: cover;
      border: 1px solid #000;
      display: block;
      margin: 0 auto 8px;
    }
    .title{
      font-size: 12px;
      line-height: 1.3;
      word-break: keep-all;
    }
    #resultField{
      text-align:center;
      margin: 24px auto;
      max-width: 520px;
    }
    #resultField table{
      width: 100%;
      font-size: 12px;
      line-height: 1.2;
      margin: 0 auto;
      border: 1px solid #000;
      border-collapse: collapse;
    }
    #resultField th, #resultField td{
      border: 1px solid #000;
      padding: 6px;
      text-align: left;
      vertical-align: middle;
    }
    #resultField th{
      background:#000;
      color:#fff;
      text-align:center;
    }
    .rankCell{
      width: 60px;
      text-align: right !important;
      padding-right: 8px !important;
    }
    a { text-decoration: none; color:#0099ff; }
  </style>

  <script>
    // -----------------------------
    // 곡 목록 + 커버 파일 매핑
    // -----------------------------
    // 커버 이미지는 /covers 폴더 안에 있어야 함.
    // 파일명은 네가 가진 파일명 그대로 사용.
    const songs = [
      { title: "Don't feel sad", cover: "Don't feel sad.jpg" },

      { title: "Ivory", cover: "Youth of Ivory.jpg" },
      { title: "O (demo)", cover: "Youth of Ivory.jpg" },

      { title: "앙드레말로", cover: "Used Black.jpg" },
      { title: "Oh My Lover", cover: "Used Black.jpg" },
      { title: "Memories", cover: "Used Black.jpg" },
      { title: "There Was a Farewell to Everyone", cover: "Used Black.jpg" },
      { title: "Santa Maria", cover: "Used Black.jpg" },

      { title: "The Little Match Boy", cover: "The Little Match Boy.jpg" },

      { title: "evening in stadium Ⅰ", cover: "us.jpg" },
      { title: "건널목", cover: "us.jpg" },

      { title: "Lost", cover: "Lost.jpg" },
      { title: "그리움으로", cover: "gri-um.jpg" },
      { title: "Goodbye2020", cover: "Goodbye2020.jpg" },

      // ✅ 물음표(?) 제거한 새 파일명 반영
      { title: "대가 없는 사랑? (Feat. kiiko)", cover: "daega-love.jpg" },
      { title: "대가 없는 사랑? (Acoustic Version)", cover: "daega-love-acoustic.jpg" },

      // Twenty 커버 묶음
      { title: "Jose", cover: "Twenty.jpg" },
      { title: "I Wanna Be Free", cover: "Twenty.jpg" },
      { title: "Leave Me Alone", cover: "Twenty.jpg" },
      { title: "Childish Love", cover: "Twenty.jpg" },
      { title: "사랑하는 사람들에게", cover: "Twenty.jpg" },
      { title: "Our Last Summer", cover: "Twenty.jpg" },
      { title: "Sunburn", cover: "Twenty.jpg" },  // ✅ Twenty 버전만 유지
      { title: "Aewol", cover: "Twenty.jpg" },
      { title: "Church", cover: "Twenty.jpg" },
      { title: "29", cover: "Twenty.jpg" },

      { title: "Only Love", cover: "Only Love.jpg" },
      { title: "HOW i WiSH!", cover: "HOW i WiSH!.jpg" }
    ];

    // 파일명에 공백/한글 있어도 안전하게 로드
    function coverSrc(fileName) {
      return "covers/" + encodeURIComponent(fileName);
    }

    // -----------------------------
    // 소트 로직
    // -----------------------------
    var namMember = [];
    for (const s of songs) namMember.push(s);

    var lstMember = [];
    var parent = [];
    var equal = [];
    var rec = [];
    var cmp1, cmp2;
    var head1, head2;
    var nrec;

    var numQuestion;
    var totalSize;
    var finishSize;
    var finishFlag;

    function initList() {
      var n = 0;
      var mid;
      var i;

      lstMember[n] = [];
      for (i = 0; i < namMember.length; i++) lstMember[n][i] = i;

      parent[n] = -1;
      totalSize = 0;
      n++;

      for (i = 0; i < lstMember.length; i++) {
        if (lstMember[i].length >= 2) {
          mid = Math.ceil(lstMember[i].length / 2);

          lstMember[n] = lstMember[i].slice(0, mid);
          totalSize += lstMember[n].length;
          parent[n] = i;
          n++;

          lstMember[n] = lstMember[i].slice(mid, lstMember[i].length);
          totalSize += lstMember[n].length;
          parent[n] = i;
          n++;
        }
      }

      for (i = 0; i < namMember.length; i++) rec[i] = 0;
      nrec = 0;

      for (i = 0; i <= namMember.length; i++) equal[i] = -1;

      cmp1 = lstMember.length - 2;
      cmp2 = lstMember.length - 1;
      head1 = 0;
      head2 = 0;
      numQuestion = 1;
      finishSize = 0;
      finishFlag = 0;
    }

    function sortList(flag) {
      var i;

      if (flag < 0) {
        rec[nrec] = lstMember[cmp1][head1];
        head1++; nrec++; finishSize++;
        while (equal[rec[nrec - 1]] != -1) {
          rec[nrec] = lstMember[cmp1][head1];
          head1++; nrec++; finishSize++;
        }
      } else if (flag > 0) {
        rec[nrec] = lstMember[cmp2][head2];
        head2++; nrec++; finishSize++;
        while (equal[rec[nrec - 1]] != -1) {
          rec[nrec] = lstMember[cmp2][head2];
          head2++; nrec++; finishSize++;
        }
      } else {
        rec[nrec] = lstMember[cmp1][head1];
        head1++; nrec++; finishSize++;
        while (equal[rec[nrec - 1]] != -1) {
          rec[nrec] = lstMember[cmp1][head1];
          head1++; nrec++; finishSize++;
        }
        equal[rec[nrec - 1]] = lstMember[cmp2][head2];

        rec[nrec] = lstMember[cmp2][head2];
        head2++; nrec++; finishSize++;
        while (equal[rec[nrec - 1]] != -1) {
          rec[nrec] = lstMember[cmp2][head2];
          head2++; nrec++; finishSize++;
        }
      }

      if (head1 < lstMember[cmp1].length && head2 == lstMember[cmp2].length) {
        while (head1 < lstMember[cmp1].length) {
          rec[nrec] = lstMember[cmp1][head1];
          head1++; nrec++; finishSize++;
        }
      } else if (head1 == lstMember[cmp1].length && head2 < lstMember[cmp2].length) {
        while (head2 < lstMember[cmp2].length) {
          rec[nrec] = lstMember[cmp2][head2];
          head2++; nrec++; finishSize++;
        }
      }

      if (head1 == lstMember[cmp1].length && head2 == lstMember[cmp2].length) {
        for (i = 0; i < lstMember[cmp1].length + lstMember[cmp2].length; i++) {
          lstMember[parent[cmp1]][i] = rec[i];
        }
        lstMember.pop(); lstMember.pop();
        cmp1 -= 2; cmp2 -= 2;
        head1 = 0; head2 = 0;

        if (head1 == 0 && head2 == 0) {
          for (i = 0; i < namMember.length; i++) rec[i] = 0;
          nrec = 0;
        }
      }

      if (cmp1 < 0) {
        document.getElementById("battleNumber").innerHTML =
          "Battle No." + (numQuestion - 1) + "<br>" +
          Math.floor(finishSize * 100 / totalSize) + "% sorted.";
        showResult();
        finishFlag = 1;
      } else {
        showImage();
      }
    }

    function showResult() {
      var ranking = 1;
      var sameRank = 1;
      var str = "";

      str += "<table>";
      str += "<tr><th style='width:70px;'>순위</th><th>곡</th></tr>";

      for (var i = 0; i < namMember.length; i++) {
        const song = namMember[lstMember[0][i]];
        str += "<tr>";
        str += "<td class='rankCell'>" + ranking + "</td>";
        str += "<td>" + escapeHtml(song.title) + "</td>";
        str += "</tr>";

        if (i < namMember.length - 1) {
          if (equal[lstMember[0][i]] == lstMember[0][i + 1]) {
            sameRank++;
          } else {
            ranking += sameRank;
            sameRank = 1;
          }
        }
      }
      str += "</table>";

      document.getElementById("resultField").innerHTML = str;
    }

    function showImage() {
      var str0 = "Battle No." + numQuestion + "<br>" +
        Math.floor(finishSize * 100 / totalSize) + "% sorted.";

      var leftIndex = lstMember[cmp1][head1];
      var rightIndex = lstMember[cmp2][head2];

      document.getElementById("battleNumber").innerHTML = str0;
      document.getElementById("leftField").innerHTML = toCard(leftIndex);
      document.getElementById("rightField").innerHTML = toCard(rightIndex);

      numQuestion++;
    }

    function toCard(n) {
      const s = namMember[n];
      const src = coverSrc(s.cover);
      return `
        <div class="card">
          <img src="${src}" alt="${escapeAttr(s.title)}">
          <div class="title">${escapeHtml(s.title)}</div>
        </div>
      `;
    }

    function escapeHtml(text) {
      return String(text)
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll("\"", "&quot;")
        .replaceAll("'", "&#039;");
    }
    function escapeAttr(text) {
      return escapeHtml(text);
    }

    window.addEventListener("DOMContentLoaded", () => {
      initList();
      showImage();
    });
  </script>
</head>

<body>
  <table id="mainTable">
    <tr>
      <td id="battleNumber" colspan="3"></td>
    </tr>

    <tr>
      <td id="leftField" onclick="if(finishFlag==0)sortList(-1);" rowspan="2"></td>

      <td class="middleField" onclick="if(finishFlag==0)sortList(0);">
        둘 다 좋다
      </td>

      <td id="rightField" onclick="if(finishFlag==0)sortList(1);" rowspan="2"></td>
    </tr>

    <tr>
      <td class="middleField" onclick="if(finishFlag==0)sortList(0);">
        모르겠다
      </td>
    </tr>
  </table>

  <div id="resultField"></div>
</body>
</html>
